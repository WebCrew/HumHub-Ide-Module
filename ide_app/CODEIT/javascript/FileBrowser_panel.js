function FileBrowser_panel(e,t){FileBrowser_panel.baseConstructor.call(this,e),this.appRef=t,this.serviceUrl=window.location,this.panelView=this.htmlElement.getChildById("PANEL_VIEW"),this.panelView.applyScrollingByTouch(),this.loadingState=this.htmlElement.getChildById("LOADING_toolButton"),this.uploadingState=this.htmlElement.getChildById("UPLOADING_BAR"),CreateEventListener(this.panelView,"dragover",function(e){return e.stopPropagation(),e.preventDefault(),!1}),CreateEventListener(HTML("DEFINE_EXECUTABLE_FILE_menuItem"),"mousedown",this.defineExecutableFilePath,this),CreateEventListener(HTML("EXECUTE_FILE_toolButton"),"mousedown",this.runExecutableFile,this),CreateEventListener(HTML("CREATE_FOLDER_menuItem"),"mousedown",this.createDir,this),CreateEventListener(HTML("REMOVE_FILE_menuItem"),"mousedown",this.removeFile,this),CreateEventListener(HTML("COPY_FILE_menuItem"),"mousedown",this.copyFile,this),CreateEventListener(HTML("PASTE_FILE_menuItem"),"mousedown",this.pasteFile,this),CreateEventListener(HTML("DOWNLOAD_FILE_menuItem"),"mousedown",this.downloadFile,this),CreateEventListener(HTML("CREATE_FILE_XML_menuItem"),"mousedown",this.createNewFile,this),CreateEventListener(HTML("CREATE_FILE_JS_menuItem"),"mousedown",this.createNewFile,this),CreateEventListener(HTML("CREATE_FILE_PHP_menuItem"),"mousedown",this.createNewFile,this),CreateEventListener(HTML("CREATE_FILE_CSS_menuItem"),"mousedown",this.createNewFile,this),CreateEventListener(HTML("CREATE_FILE_HTML_menuItem"),"mousedown",this.createNewFile,this),CreateEventListener(HTML("CREATE_FILE_LESS_menuItem"),"mousedown",this.createNewFile,this),CreateEventListener(HTML("CREATE_FILE_MD_menuItem"),"mousedown",this.createNewFile,this),CreateEventListener(HTML("CREATE_FILE_SQL_menuItem"),"mousedown",this.createNewFile,this),this.lastMouseDownTime=null,this.isLocked=!1,this.clipboard={},this.executableFilePath="",this.executableFileWindow=null}ExtendClass(FileBrowser_panel,CODEIT_TreeView),FileBrowser_panel.prototype.defineExecutableFilePath=function(e){0!=this.selectedNodes.length&&(this.executableFilePath=this.getNodePath(this.selectedNodes[0]))},FileBrowser_panel.prototype.runExecutableFile=function(e){return""==this.executableFilePath?void alert(STR['The main file is not defined. Please, select "Define as main file" from the menu.']):(console.log(this.executableFileWindow),null!=this.executableFileWindow&&this.executableFileWindow.location?this.executableFileWindow.location="?action=runExecutableFile&filePath="+this.executableFilePath:this.executableFileWindow=window.open("?action=runExecutableFile&filePath="+this.executableFilePath),void this.executableFileWindow.focus())},FileBrowser_panel.prototype.downloadFile=function(e){0!=this.selectedNodes.length&&window.open("?action=downloadFile&filePath="+this.getNodePath(this.selectedNodes[0]))},FileBrowser_panel.prototype.onEndEditNodeName=function(e){FileBrowser_panel.superClass.onEndEditNodeName.call(this,e);var t=e.parentElement.parentElement;if("LI"==t.nodeName){var i=e.value;if(!this.isValidFileName(i))return void(t.getElementsByTagName("div")[0].innerHTML=e.previousValue);if(t.hasAttribute("itemType")){var o=t.getAttribute("itemType");if("file"==o||"dir"==o){var a=this.getNodePath(t);this.renameFile(a,i,t)}}}},FileBrowser_panel.prototype.selectNode=function(e){if(FileBrowser_panel.superClass.selectNode.call(this,e),e.hasAttribute("itemType")){var t=e.getAttribute("itemType");if("file"==t){var i=this.getNodePath(e),o=PathInfo(i);switch(o.fileExtension){case"jpg":case"jpeg":case"png":case"pdf":case"zip":case"gif":return}this.appRef.codeEditor_panel.loadDocument(i)}}},FileBrowser_panel.prototype.expandNode=function(e){var t=FileBrowser_panel.superClass.expandNode.call(this,e);void 0!=t&&this.isDirectoryNode(e)&&this.loadNodeChildren(e)},FileBrowser_panel.prototype.showLoadingState=function(){this.loadingState.style.display="block"},FileBrowser_panel.prototype.hideLoadingState=function(){this.loadingState.style.display="none"},FileBrowser_panel.prototype.showUploadingState=function(){this.uploadingState.style.display="block"},FileBrowser_panel.prototype.hideUploadingState=function(){this.uploadingState.style.display="none"},FileBrowser_panel.prototype.loadNodeChildren=function(e){this.loadNodes("?action=listFiles&pathDir="+this.getNodePath(e),this.getNodeElement_ul(e))},FileBrowser_panel.prototype.loadNodes=function(e,t){t||(t=this.panelView),t.innerHTML="",this.showLoadingState();var i=this;SendAndLoad(e,null,function(e){i.hideLoadingState(),t.innerHTML=e.target.responseText})},FileBrowser_panel.prototype.isValidFileName=function(e){return/[^a-z0-9\.\s\-\_]/gi.test(e)?!1:!0},FileBrowser_panel.prototype.getNodeFileType=function(e){return e&&e.hasAttribute("itemType")?e.getAttribute("itemType"):null},FileBrowser_panel.prototype.isDirectoryNode=function(e){return"dir"==this.getNodeFileType(e)?!0:!1},FileBrowser_panel.prototype.isFileNode=function(e){return"dir"==this.getNodeFileType(e)?!1:!0},FileBrowser_panel.prototype.getNodePath=function(e){return e.getAttribute("title")},FileBrowser_panel.prototype.setNodePath=function(e,t){e.setAttribute("title",t)},FileBrowser_panel.prototype.createDir=function(e){if(this.isDirectoryNode(this.selectedNodes[0])){var t=SendAndLoad(this.serviceUrl,{action:"createDir",parentDirPath:this.getNodePath(this.selectedNodes[0])},Bind(this,this.onCreateDir));t.element_li=this.selectedNodes[0],this.showLoadingState()}},FileBrowser_panel.prototype.onCreateDir=function(e){this.hideLoadingState();var t=DefaultResponseXML(e);if(1==t){var i=e.target;this.loadNodeChildren(i.element_li)}},FileBrowser_panel.prototype.createNewFile=function(e){if(0!=this.selectedNodes.length&&this.isDirectoryNode(this.selectedNodes[0])){var t=this.getNodePath(this.selectedNodes[0]),i=e.target;if(i.hasAttribute("fileType")){var o=i.getAttribute("fileType"),a=SendAndLoad(this.serviceUrl,{action:"createNewFile",fileType:o,parentDirPath:t},Bind(this,this.onCreateNewFile));a.element_li=this.selectedNodes[0],this.showLoadingState()}}},FileBrowser_panel.prototype.onCreateNewFile=function(e){this.hideLoadingState();var t=DefaultResponseXML(e);if(1==t){var i=e.target;this.loadNodeChildren(i.element_li)}},FileBrowser_panel.prototype.removeFile=function(e){if(0!=this.selectedNodes.length){var t=this.selectedNodes[0],i=t.getElementsByTagName("div")[0].textContent;if("Hard disk"==i||i==STR.Trash)return void alert(STR["You can not remove the item:"]+"\n\n"+i+"!");if(null!=this.getNodeFileType(t)){var o=this.getNodePath(t),a=this.appRef.codeEditor_panel.getDocumentsInPath(o);if(a.length>0)return void alert(STR["There are opened documents relative to the path:"]+"\n\n"+o+".\n\n"+STR["Close the documents and try again."]);var n=confirm(STR["Are you sure you want to remove the element:"]+"\n\n"+o);if(n){var l=SendAndLoad(this.serviceUrl,{action:"removeFile",filePath:o},Bind(this,this.onRemoveFile));l.element_li=t,this.showLoadingState()}}}},FileBrowser_panel.prototype.onRemoveFile=function(e){this.hideLoadingState();var t=DefaultResponseXML(e);if(1==t){this.selectedNodes=[];var i=e.target;i.element_li.parentNode.removeChild(i.element_li)}},FileBrowser_panel.prototype.copyFile=function(e){if(0!=this.selectedNodes.length){var t=this.selectedNodes[0],i=t.getElementsByTagName("div")[0].textContent;return"Hard disk"==i?void alert(STR["You can not copy the item Hard disk!"]):void(null!=this.getNodeFileType(t)&&(this.clipboard.copiedNode=t,console.log(this.clipboard)))}},FileBrowser_panel.prototype.pasteFile=function(e){0!=this.selectedNodes.length&&this.isDirectoryNode(this.selectedNodes[0])&&this.clipboard.copiedNode&&this.duplicateFile(this.clipboard.copiedNode,this.selectedNodes[0])},FileBrowser_panel.prototype.renameFile=function(e,t,i){this.isLocked=!0;var o=SendAndLoad(this.serviceUrl,{action:"renameFile",filePath:e,newFileName:t},Bind(this,this.onRenameFile));o.filePath=e,o.newFileName=t,o.element_li=i,this.showLoadingState()},FileBrowser_panel.prototype.onRenameFile=function(e){this.hideLoadingState(),this.isLocked=!1;var t=DefaultResponseXML(e),i=e.target,o=i.filePath,a=PathInfo(o);if(1!=t)return void(n.getElementsByTagName("div")[0].innerHTML=a.fileName);var n=i.element_li,l=i.newFileName,r=l;""!=a.dir&&(r=a.dir+"/"+l),this.setNodePath(n,r);var s=n.getAttribute("itemType");if("file"==s){var d=l.split("."),h="";d.length>0&&(h="treeViewItemIcon_"+d[d.length-1]),n.getElementsByTagName("div")[0].className=h}else if("dir"==s)for(var p,c,u=n.getElementsByTagName("li"),m=u.length,g=0;m>g;g++)p=this.getNodePath(u[g]),c=p.replace(o,r),this.setNodePath(u[g],c);this.appRef.codeEditor_panel.updateDocumentsPath(o,r)},FileBrowser_panel.prototype.onUploadFileProgress=function(e){this.uploadingState.value+=e.loaded},FileBrowser_panel.prototype.onUploadFileEnd=function(e){var t=DefaultResponseXML(e);if(1==t){this.uploadingState.value==this.uploadingState.max&&(this.uploadingState.value=null,this.uploadingState.max=null,this.hideUploadingState());var i=e.target;this.loadNodeChildren(i.element_li)}},FileBrowser_panel.prototype.uploadFile=function(e,t){this.uploadingState.max+=e.size,console.log(e.name+" "+this.uploadingState.max),this.showUploadingState();var i=new XMLHttpRequest;i.open("POST",this.serviceUrl,!0),i.onload=Bind(this,this.onUploadFileEnd),i.upload.onprogress=Bind(this,this.onUploadFileProgress);var o=new FormData;return o.append("action","uploadFile"),o.append("targetPath",t),o.append("Filedata",e),i.send(o),i},FileBrowser_panel.prototype.onCheckBeforeUpload=function(e){console.log(e),this.hideLoadingState();try{var t=e.target,i=t.responseXML,o=i.getElementsByTagName("state")[0].firstChild.nodeValue,a=i.getElementsByTagName("message")[0].firstChild.nodeValue;if("EXISTENT_FILE"==o){var n=confirm(STR["An element named:"]+"\n\n"+t.fileToUpload.name+"\n\n"+STR["already exists in the destination folder"]+"!\n"+STR["Do you want to replace it?"]);if(!n)return}else if("ERROR"==o)return void alert(a);var l=this.uploadFile(t.fileToUpload,t.remoteDirPath);l.element_li=t.element_li}catch(r){alert(STR["There was an unknown error while checking files!"]+t.responseText)}},FileBrowser_panel.prototype.onDragOverNode=function(e){var t=e.target.getParentByAttribute("itemtype","dir");t.classList.add(this.dragOverNodeClassName)},FileBrowser_panel.prototype.onDragLeaveNode=function(e){var t=e.target.getParentByAttribute("itemtype","dir");t.classList.remove(this.dragOverNodeClassName)},FileBrowser_panel.prototype.onDragStartNode=function(e){e.dataTransfer.setData("text/plain"," "),console.log(e),this.clipboard.dragNode=e.target,console.log(this.clipboard.dragNode),e.altKey||(e.dataTransfer.effectAllowed="move"),e.stopPropagation()},FileBrowser_panel.prototype.onDropOnNode=function(e){this.onDragLeaveNode(e),e.stopPropagation(),e.preventDefault();var t=e.target.getParentByAttribute("itemtype","dir");if(console.log("onDropOnNode"),console.log(t),t){this.clipboard.dropNode=t;var i=t.getAttribute("title");if("Files"==e.dataTransfer.types){this.showLoadingState();for(var o,a=e.dataTransfer.files,n=null,l=a.length,r=0;l>r;r++)o=SendAndLoad(this.serviceUrl,{action:"checkForExistentFile",filePath:i+"/"+a[r].name},Bind(this,this.onCheckBeforeUpload)),n=a[r],o.remoteDirPath=i,o.fileToUpload=n,o.element_li=t}else this.clipboard.dragNode&&this.clipboard.dropNode&&(e.altKey?this.duplicateFile(this.clipboard.dragNode,this.clipboard.dropNode):this.moveFile(this.clipboard.dragNode,this.clipboard.dropNode),this.clipboard={})}},FileBrowser_panel.prototype.duplicateFile=function(e,t){if(e!=t){var i=this.getNodePath(e),o=this.getNodePath(t),a=PathInfo(i);if(o=""==o?a.fileName:o+"/"+a.fileName,0==o.indexOf(i)&&i!=o)return void alert(STR["You can not paste a folder into itself or folder daughter!"]);var n=SendAndLoad(this.serviceUrl,{action:"duplicateFile",sourcePath:i,targetPath:o},Bind(this,this.onDuplicateFile));n.source_element_li=e,n.target_element_li=t}},FileBrowser_panel.prototype.onDuplicateFile=function(e){console.log(e),this.hideLoadingState();var t=e.target,i=DefaultResponseXML(e);if(i)return void this.loadNodeChildren(t.target_element_li);try{for(var o,a,n,l=t.responseXML,r=l.getElementsByTagName("fileToReplace"),s=r.length,d=0;s>d;d++){o=r[d].getAttribute("sourcePath"),a=r[d].getAttribute("targetPath");var h=PathInfo(a);n=h.fileName,dirName=h.dir;var p=confirm(STR["An element named:"]+'\n\n"'+n+'"\n\n'+STR["already exists in the destination folder"]+':\n\n"'+dirName+'".\n\n'+STR["Do you want to replace it?"]);if(p){var c=SendAndLoad(this.serviceUrl,{action:"duplicateFile",sourcePath:o,targetPath:a,replaceFileTarget:!0},Bind(this,this.onDuplicateFile));c.source_element_li=t.source_element_li,c.target_element_li=t.target_element_li}}}catch(u){alert(STR["An unknown error occurred while copying files or folders!"]+" "+t.responseText)}},FileBrowser_panel.prototype.moveFile=function(e,t){if(e!=t){var i=this.getNodePath(e),o=this.getNodePath(t),a=PathInfo(i);if(o=""==o?a.fileName:o+"/"+a.fileName,0==o.indexOf(i))return i==o?void 0:void alert(STR["You can not move a folder into itself or folder daughter!"]);var n=SendAndLoad(this.serviceUrl,{action:"moveFile",sourcePath:i,targetPath:o},Bind(this,this.onMoveFile));n.source_element_li=e,n.target_element_li=t,n.sourcePath=i,n.targetPath=o}},FileBrowser_panel.prototype.onMoveFile=function(e){console.log(e),this.hideLoadingState();var t=e.target,i=DefaultResponseXML(e);if(i)return this.loadNodeChildren(t.target_element_li),t.source_element_li.parentNode&&this.loadNodeChildren(t.source_element_li.parentNode.getParentByAttribute("itemtype","dir")),void this.appRef.codeEditor_panel.updateDocumentsPath(t.sourcePath,t.targetPath);try{for(var o,a,n,l,r=t.responseXML,s=r.getElementsByTagName("fileToReplace"),d=s.length,h=0;d>h;h++){o=s[h].getAttribute("sourcePath"),a=s[h].getAttribute("targetPath");var p=PathInfo(a);n=p.fileName,l=p.dir;var c=confirm(STR["An element named:"]+'\n\n"'+n+'"\n\n'+STR["already exists in the destination folder"]+':\n\n"'+l+'".\n\n'+STR["Do you want to replace it?"]);if(c){var u=SendAndLoad(this.serviceUrl,{action:"moveFile",sourcePath:o,targetPath:a,replaceFileTarget:!0},Bind(this,this.onMoveFile));u.source_element_li=t.source_element_li,u.target_element_li=t.target_element_li,u.sourcePath=o,u.targetPath=a}}}catch(m){alert(STR["An unknown error occurred while moving files or folders!"]+t.responseText)}};