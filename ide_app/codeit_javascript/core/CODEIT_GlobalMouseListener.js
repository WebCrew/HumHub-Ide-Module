function CODEIT_GlobalMouseListener(){this.mouseDownPt={x:0,y:0},this.mouseUpPt={x:0,y:0},this.mouseMovePt={x:0,y:0},this.isMouseButtonPressed=!1,this.isDragAction=!1,this.checkForMouseDragPause=!1,this.previousMouseMovePt={x:0,y:0},this.checkForMouseMovePauseIntervalId=null,this.isMouseMovePaused=!1,this.snapValue=20,this.isSnapped=!1,this.objectTarget=null,this.snapToAngle=!0,this.snapToAxisXY=!0,this.lastMouseUpTime=(new Date).getTime(),this.initEventListeners(),this.preventPageScroll=!0,this.lockedPageScroll=!1}CODEIT_GlobalMouseListener.prototype.initEventListeners=function(){var e=document.getElementsByTagName("html")[0];DEVICE_WITH_TOUCH_EVENTS?(CreateEventListener(e,"touchstart",this.onTouchStart,this,!0),CreateEventListener(e,"touchmove",this.onTouchMove,this),CreateEventListener(e,"touchend",this.onTouchEnd,this)):(CreateEventListener(e,"mousedown",this.onMouseDown,this),CreateEventListener(e,"mousemove",this.onMouseMove,this),CreateEventListener(e,"mouseup",this.onMouseUp,this))},CODEIT_GlobalMouseListener.prototype.startSnap=function(e){this.snapValue=e||20,this.isSnapped=!0,this.previousMouseMovePt.x=this.mouseMovePt.x,this.previousMouseMovePt.y=this.mouseMovePt.y},CODEIT_GlobalMouseListener.prototype.lookForMouseMovePause=function(e){if(!this.isSnapped){if(this.previousMouseMovePt.x==this.mouseMovePt.x&&this.previousMouseMovePt.y==this.mouseMovePt.y){if(this.isMouseMovePaused)return;return this.onMouseMoveStartPause(e),void(this.isMouseMovePaused=!0)}this.isMouseMovePaused&&(this.onMouseMoveEndPause(e),this.isMouseMovePaused=!1),this.previousMouseMovePt.x=this.mouseMovePt.x,this.previousMouseMovePt.y=this.mouseMovePt.y}},CODEIT_GlobalMouseListener.prototype.onMouseClick=function(e){},CODEIT_GlobalMouseListener.prototype.onMouseDoubleClick=function(e){},CODEIT_GlobalMouseListener.prototype.onStartDrag=function(e){this.checkForMouseDragPause&&(this.checkForMouseMovePauseIntervalId=setInterval(Bind(this,this.lookForMouseMovePause),100)),this.objectTarget&&this.objectTarget.onGlobalMouseEndDrag&&this.objectTarget.onGlobalMouseStartDrag(e)},CODEIT_GlobalMouseListener.prototype.onEndDrag=function(e){this.checkForMouseDragPause&&(clearInterval(this.checkForMouseMovePauseIntervalId),this.isMouseMovePaused=!1,this.isSnapped=!1),this.objectTarget&&this.objectTarget.onGlobalMouseEndDrag&&this.objectTarget.onGlobalMouseEndDrag(e),this.snapToAngle=!0},CODEIT_GlobalMouseListener.prototype.onDrag=function(e){e.shiftKey&&this.snapToAngle&&this.calculateSnapToAngle(),this.objectTarget&&this.objectTarget.onGlobalMouseDrag&&this.objectTarget.onGlobalMouseDrag(e)},CODEIT_GlobalMouseListener.prototype.onMouseWheel=function(e){},CODEIT_GlobalMouseListener.prototype.onMouseMoveStartPause=function(e){this.isDragAction&&this.onStartPauseDrag(e)},CODEIT_GlobalMouseListener.prototype.onMouseMoveEndPause=function(e){this.isDragAction&&this.onEndPauseDrag(e)},CODEIT_GlobalMouseListener.prototype.onStartPauseDrag=function(e){this.objectTarget&&this.objectTarget.onGlobalMouseDragStartPause&&this.objectTarget.onGlobalMouseDragStartPause(e)},CODEIT_GlobalMouseListener.prototype.onEndPauseDrag=function(e){this.objectTarget&&this.objectTarget.onGlobalMouseDragEndPause&&this.objectTarget.onGlobalMouseDragEndPause(e)},CODEIT_GlobalMouseListener.prototype.onMouseDown=function(e){this.eventLocationToPoint(e,this.mouseDownPt),this.mouseMovePt.x=this.mouseDownPt.x,this.mouseMovePt.y=this.mouseDownPt.y,e.srcElement instanceof HTMLUListElement||(this.isMouseButtonPressed=!0,this.objectTarget&&this.objectTarget.onGlobalMouseDown&&this.objectTarget.onGlobalMouseDown(e))},CODEIT_GlobalMouseListener.prototype.onMouseUp=function(e){this.eventLocationToPoint(e,this.mouseUpPt),this.objectTarget&&this.objectTarget.onGlobalMouseUp&&this.objectTarget.onGlobalMouseUp(e);var t=(new Date).getTime();t-this.lastMouseUpTime<250&&this.objectTarget&&this.objectTarget.onGlobalMouseDoubleClick&&this.objectTarget.onGlobalMouseDoubleClick(e),this.lastMouseUpTime=t,this.isMouseButtonPressed=!1,this.isDragAction&&this.onEndDrag(e),this.isDragAction=!1,this.objectTarget=null},CODEIT_GlobalMouseListener.prototype.onMouseClick=function(e){this.objectTarget&&this.objectTarget.onGlobalMouseClick&&this.objectTarget.onGlobalMouseClick(e)},CODEIT_GlobalMouseListener.prototype.onMouseMove=function(e){if(this.preventPageScroll&&e.preventDefault(),this.preventPageScroll=!0,this.eventLocationToPoint(e,this.mouseMovePt),this.isSnapped){if(this.distanceFromPoints(this.mouseMovePt,this.previousMouseMovePt)<this.snapValue)return;this.isSnapped=!1}return this.isMouseButtonPressed?this.isDragAction?void this.onDrag(e):void(this.distanceFromPoints(this.mouseMovePt,this.mouseDownPt)>5&&(this.isDragAction=!0,this.onStartDrag(e))):void(this.objectTarget&&this.objectTarget.onGlobalMouseMove&&this.objectTarget.onGlobalMouseMove(e))},CODEIT_GlobalMouseListener.prototype.startDrag=function(e){this.isDragAction=!0,this.onStartDrag(null)},CODEIT_GlobalMouseListener.prototype.onTouchStart=function(e){this.onMouseDown(e)},CODEIT_GlobalMouseListener.prototype.onTouchMove=function(e){this.onMouseMove(e)},CODEIT_GlobalMouseListener.prototype.onTouchEnd=function(e){0==e.targetTouches.length&&this.onMouseUp(e)},CODEIT_GlobalMouseListener.prototype.onTouchCancel=function(e){},CODEIT_GlobalMouseListener.prototype.resetState=function(){this.isDragAction=!1,this.isSnapped=!1,this.isMouseButtonPressed=!1,this.isMouseMovePaused=!1,this.objectTarget=null},CODEIT_GlobalMouseListener.prototype.eventLocationToPoint=function(e,t){IS_IOS?e.targetTouches.length>0&&(t.x=e.targetTouches[0].pageX,t.y=e.targetTouches[0].pageY):(e||(e=window.event),e.pageX||e.pageY?(t.x=e.pageX,t.y=e.pageY):(e.clientX||e.clientY)&&(t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop))},CODEIT_GlobalMouseListener.prototype.distanceFromPoints=function(e,t){var o=t.x-e.x,s=t.y-e.y;return Math.sqrt(o*o+s*s)},CODEIT_GlobalMouseListener.prototype.calculateSnapToAngle=function(){var e=Math.PI/4,t=this.mouseMovePt.x-this.mouseDownPt.x,o=this.mouseMovePt.y-this.mouseDownPt.y,s=Math.atan2(o,t),i=Math.sqrt(t*t+o*o),n=Math.round(s/e)*e;this.mouseMovePt.x=this.mouseDownPt.x+i*Math.cos(n),this.mouseMovePt.y=this.mouseDownPt.y+i*Math.sin(n)},CODEIT_GlobalMouseListener.prototype.elementChildrenToDraggableElements=function(e){for(var t=0;t<e.childNodes.length;t++)3!=e.childNodes[t].nodeType&&this.createDraggableElement(e.childNodes[t])},CODEIT_GlobalMouseListener.prototype.createDraggableElement=function(e){CreateEventListener(e,"mousedown",this.onMouseDownOnDraggableElement,this)},CODEIT_GlobalMouseListener.prototype.onMouseDownOnDraggableElement=function(e){this.draggableElement=e.target;var t=this.draggableElement.getPosition();this.draggableElement.dragOffsetX=GLOBAL_MOUSE_LISTENER.mouseMovePt.x-t.x,this.draggableElement.dragOffsetY=GLOBAL_MOUSE_LISTENER.mouseMovePt.y-t.y,GLOBAL_MOUSE_LISTENER.objectTarget=this},CODEIT_GlobalMouseListener.prototype.onGlobalMouseDrag=function(e){this.draggableElement.setPosition(GLOBAL_MOUSE_LISTENER.mouseMovePt.x-this.draggableElement.dragOffsetX,GLOBAL_MOUSE_LISTENER.mouseMovePt.y-this.draggableElement.dragOffsetY)};var GLOBAL_MOUSE_LISTENER=new CODEIT_GlobalMouseListener;